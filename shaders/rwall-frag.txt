#include "preamble"

uniform float numSpads;
uniform float spadRadius;
uniform float aspect;
uniform vec2 firstSpad;
uniform vec2 lastSpad;
uniform vec4 uColor;

varying vec2 mPos;

void main() {
    gl_FragColor = vec4(0.0);
    vec2 coord;
    coord.x = (mPos.x * 2.0 - 1.0) * aspect;
    coord.y = mPos.y * 2.0 - 1.0;
    float top = firstSpad.y + spadRadius;
    float bottom = lastSpad.y - spadRadius;
    float left = min(firstSpad.x, lastSpad.x) - spadRadius;
    float right = max(firstSpad.x, lastSpad.x) + spadRadius;
    if ((coord.x >= left) && (coord.y <= top) &&
            (coord.x <= right) && (coord.y >= bottom)) {
        vec2 scanSize = firstSpad - lastSpad;
        vec2 normCoord = (coord - lastSpad) / scanSize;
        if (distance(coord, lastSpad + scanSize / (numSpads - 1.0) * floor(normCoord.y * numSpads + 0.5)) <= spadRadius) {
            gl_FragColor = uColor;
        }
    }
}