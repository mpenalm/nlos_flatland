#include "trace-frag"

#include "bsdf"
#include "intersect"

void intersect(Ray ray, inout Intersection isect) {
    bboxIntersect(ray, vec2(0.0), vec2(1.79, 1.0), 3.0, isect);

    // relay wall
    lineIntersect(ray, vec2(1.2, -1.0), vec2(1.2, -0.2), 0.0, isect);

    // first hidden wall (mirror wall)
    lineIntersect(ray, vec2(0.4025, -0.4), vec2(0.3975, -0.395), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.395), vec2(0.4025, -0.39), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.39), vec2(0.3975, -0.385), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.385), vec2(0.4025, -0.38), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.38), vec2(0.3975, -0.375), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.375), vec2(0.4025, -0.37), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.37), vec2(0.3975, -0.365), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.365), vec2(0.4025, -0.36), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.36), vec2(0.3975, -0.355), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.355), vec2(0.4025, -0.35), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.35), vec2(0.3975, -0.345), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.345), vec2(0.4025, -0.33999999999999997), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.33999999999999997), vec2(0.3975, -0.33499999999999996), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.33499999999999996), vec2(0.4025, -0.32999999999999996), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.32999999999999996), vec2(0.3975, -0.32499999999999996), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.32499999999999996), vec2(0.4025, -0.31999999999999995), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.31999999999999995), vec2(0.3975, -0.31499999999999995), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.31499999999999995), vec2(0.4025, -0.30999999999999994), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.30999999999999994), vec2(0.3975, -0.30499999999999994), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.30499999999999994), vec2(0.4025, -0.29999999999999993), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.29999999999999993), vec2(0.3975, -0.29499999999999993), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.29499999999999993), vec2(0.4025, -0.2899999999999999), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.2899999999999999), vec2(0.3975, -0.2849999999999999), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.2849999999999999), vec2(0.4025, -0.2799999999999999), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.2799999999999999), vec2(0.3975, -0.2749999999999999), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.2749999999999999), vec2(0.4025, -0.2699999999999999), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.2699999999999999), vec2(0.3975, -0.2649999999999999), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.2649999999999999), vec2(0.4025, -0.2599999999999999), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.2599999999999999), vec2(0.3975, -0.2549999999999999), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.2549999999999999), vec2(0.4025, -0.2499999999999999), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.2499999999999999), vec2(0.3975, -0.24499999999999988), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.24499999999999988), vec2(0.4025, -0.23999999999999988), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.23999999999999988), vec2(0.3975, -0.23499999999999988), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.23499999999999988), vec2(0.4025, -0.22999999999999987), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.22999999999999987), vec2(0.3975, -0.22499999999999987), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.22499999999999987), vec2(0.4025, -0.21999999999999986), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.21999999999999986), vec2(0.3975, -0.21499999999999986), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.21499999999999986), vec2(0.4025, -0.20999999999999985), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.20999999999999985), vec2(0.3975, -0.20499999999999985), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.20499999999999985), vec2(0.4025, -0.19999999999999984), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.19999999999999984), vec2(0.3975, -0.19499999999999984), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.19499999999999984), vec2(0.4025, -0.18999999999999984), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.18999999999999984), vec2(0.3975, -0.18499999999999983), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.18499999999999983), vec2(0.4025, -0.17999999999999983), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.17999999999999983), vec2(0.3975, -0.17499999999999982), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.17499999999999982), vec2(0.4025, -0.16999999999999982), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.16999999999999982), vec2(0.3975, -0.1649999999999998), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.1649999999999998), vec2(0.4025, -0.1599999999999998), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.1599999999999998), vec2(0.3975, -0.1549999999999998), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.1549999999999998), vec2(0.4025, -0.1499999999999998), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.1499999999999998), vec2(0.3975, -0.1449999999999998), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.1449999999999998), vec2(0.4025, -0.1399999999999998), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.1399999999999998), vec2(0.3975, -0.1349999999999998), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.1349999999999998), vec2(0.4025, -0.12999999999999978), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.12999999999999978), vec2(0.3975, -0.12499999999999978), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.12499999999999978), vec2(0.4025, -0.11999999999999977), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.11999999999999977), vec2(0.3975, -0.11499999999999977), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.11499999999999977), vec2(0.4025, -0.10999999999999976), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.10999999999999976), vec2(0.3975, -0.10499999999999976), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.10499999999999976), vec2(0.4025, -0.09999999999999976), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.09999999999999976), vec2(0.3975, -0.09499999999999975), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.09499999999999975), vec2(0.4025, -0.08999999999999975), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.08999999999999975), vec2(0.3975, -0.08499999999999974), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.08499999999999974), vec2(0.4025, -0.07999999999999974), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.07999999999999974), vec2(0.3975, -0.07499999999999973), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.07499999999999973), vec2(0.4025, -0.06999999999999973), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.06999999999999973), vec2(0.3975, -0.06499999999999972), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.06499999999999972), vec2(0.4025, -0.05999999999999973), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.05999999999999973), vec2(0.3975, -0.05499999999999973), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.05499999999999973), vec2(0.4025, -0.04999999999999973), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.04999999999999973), vec2(0.3975, -0.044999999999999735), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.044999999999999735), vec2(0.4025, -0.03999999999999974), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.03999999999999974), vec2(0.3975, -0.03499999999999974), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.03499999999999974), vec2(0.4025, -0.02999999999999974), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.02999999999999974), vec2(0.3975, -0.024999999999999738), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.024999999999999738), vec2(0.4025, -0.019999999999999737), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.019999999999999737), vec2(0.3975, -0.014999999999999736), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.014999999999999736), vec2(0.4025, -0.009999999999999735), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, -0.009999999999999735), vec2(0.3975, -0.004999999999999735), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, -0.004999999999999735), vec2(0.4025, 0.0), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.0), vec2(0.3975, 0.0050000000000002655), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.0050000000000002655), vec2(0.4025, 0.010000000000000266), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.010000000000000266), vec2(0.3975, 0.015000000000000267), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.015000000000000267), vec2(0.4025, 0.020000000000000268), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.020000000000000268), vec2(0.3975, 0.02500000000000027), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.02500000000000027), vec2(0.4025, 0.03000000000000027), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.03000000000000027), vec2(0.3975, 0.03500000000000027), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.03500000000000027), vec2(0.4025, 0.040000000000000265), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.040000000000000265), vec2(0.3975, 0.04500000000000026), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.04500000000000026), vec2(0.4025, 0.05000000000000026), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.05000000000000026), vec2(0.3975, 0.05500000000000026), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.05500000000000026), vec2(0.4025, 0.060000000000000255), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.060000000000000255), vec2(0.3975, 0.06500000000000025), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.06500000000000025), vec2(0.4025, 0.07000000000000026), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.07000000000000026), vec2(0.3975, 0.07500000000000026), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.07500000000000026), vec2(0.4025, 0.08000000000000027), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.08000000000000027), vec2(0.3975, 0.08500000000000027), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.08500000000000027), vec2(0.4025, 0.09000000000000027), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.09000000000000027), vec2(0.3975, 0.09500000000000028), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.09500000000000028), vec2(0.4025, 0.10000000000000028), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.10000000000000028), vec2(0.3975, 0.10500000000000029), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.10500000000000029), vec2(0.4025, 0.11000000000000029), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.11000000000000029), vec2(0.3975, 0.1150000000000003), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.1150000000000003), vec2(0.4025, 0.1200000000000003), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.1200000000000003), vec2(0.3975, 0.1250000000000003), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.1250000000000003), vec2(0.4025, 0.1300000000000003), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.1300000000000003), vec2(0.3975, 0.13500000000000031), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.13500000000000031), vec2(0.4025, 0.14000000000000032), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.14000000000000032), vec2(0.3975, 0.14500000000000032), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.14500000000000032), vec2(0.4025, 0.15000000000000033), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.15000000000000033), vec2(0.3975, 0.15500000000000033), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.15500000000000033), vec2(0.4025, 0.16000000000000034), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.16000000000000034), vec2(0.3975, 0.16500000000000034), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.16500000000000034), vec2(0.4025, 0.17000000000000035), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.17000000000000035), vec2(0.3975, 0.17500000000000035), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.17500000000000035), vec2(0.4025, 0.18000000000000035), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.18000000000000035), vec2(0.3975, 0.18500000000000036), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.18500000000000036), vec2(0.4025, 0.19000000000000036), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.19000000000000036), vec2(0.3975, 0.19500000000000037), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.19500000000000037), vec2(0.4025, 0.20000000000000037), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.20000000000000037), vec2(0.3975, 0.20500000000000038), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.20500000000000038), vec2(0.4025, 0.21000000000000038), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.21000000000000038), vec2(0.3975, 0.21500000000000039), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.21500000000000039), vec2(0.4025, 0.2200000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.2200000000000004), vec2(0.3975, 0.2250000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.2250000000000004), vec2(0.4025, 0.2300000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.2300000000000004), vec2(0.3975, 0.2350000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.2350000000000004), vec2(0.4025, 0.2400000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.2400000000000004), vec2(0.3975, 0.2450000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.2450000000000004), vec2(0.4025, 0.2500000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.2500000000000004), vec2(0.3975, 0.2550000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.2550000000000004), vec2(0.4025, 0.2600000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.2600000000000004), vec2(0.3975, 0.2650000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.2650000000000004), vec2(0.4025, 0.2700000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.2700000000000004), vec2(0.3975, 0.2750000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.2750000000000004), vec2(0.4025, 0.2800000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.2800000000000004), vec2(0.3975, 0.2850000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.2850000000000004), vec2(0.4025, 0.2900000000000004), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.2900000000000004), vec2(0.3975, 0.29500000000000043), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.29500000000000043), vec2(0.4025, 0.30000000000000043), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.30000000000000043), vec2(0.3975, 0.30500000000000044), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.30500000000000044), vec2(0.4025, 0.31000000000000044), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.31000000000000044), vec2(0.3975, 0.31500000000000045), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.31500000000000045), vec2(0.4025, 0.32000000000000045), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.32000000000000045), vec2(0.3975, 0.32500000000000046), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.32500000000000046), vec2(0.4025, 0.33000000000000046), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.33000000000000046), vec2(0.3975, 0.33500000000000046), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.33500000000000046), vec2(0.4025, 0.34000000000000047), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.34000000000000047), vec2(0.3975, 0.3450000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.3450000000000005), vec2(0.4025, 0.3500000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.3500000000000005), vec2(0.3975, 0.3550000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.3550000000000005), vec2(0.4025, 0.3600000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.3600000000000005), vec2(0.3975, 0.3650000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.3650000000000005), vec2(0.4025, 0.3700000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.3700000000000005), vec2(0.3975, 0.3750000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.3750000000000005), vec2(0.4025, 0.3800000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.3800000000000005), vec2(0.3975, 0.3850000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.3850000000000005), vec2(0.4025, 0.3900000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.4025, 0.3900000000000005), vec2(0.3975, 0.3950000000000005), 0.0, isect);
    lineIntersect(ray, vec2(0.3975, 0.3950000000000005), vec2(0.4025, 0.4000000000000005), 0.0, isect);

    // doubly-hidden wall
    lineIntersect(ray, vec2(1.20625, 0.0), vec2(1.1937499999999999, 0.0125), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.0125), vec2(1.20625, 0.025), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.025), vec2(1.1937499999999999, 0.037500000000000006), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.037500000000000006), vec2(1.20625, 0.05), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.05), vec2(1.1937499999999999, 0.0625), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.0625), vec2(1.20625, 0.075), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.075), vec2(1.1937499999999999, 0.0875), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.0875), vec2(1.20625, 0.09999999999999999), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.09999999999999999), vec2(1.1937499999999999, 0.11249999999999999), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.11249999999999999), vec2(1.20625, 0.12499999999999999), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.12499999999999999), vec2(1.1937499999999999, 0.13749999999999998), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.13749999999999998), vec2(1.20625, 0.15), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.15), vec2(1.1937499999999999, 0.1625), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.1625), vec2(1.20625, 0.17500000000000002), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.17500000000000002), vec2(1.1937499999999999, 0.18750000000000003), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.18750000000000003), vec2(1.20625, 0.20000000000000004), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.20000000000000004), vec2(1.1937499999999999, 0.21250000000000005), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.21250000000000005), vec2(1.20625, 0.22500000000000006), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.22500000000000006), vec2(1.1937499999999999, 0.23750000000000007), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.23750000000000007), vec2(1.20625, 0.25000000000000006), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.25000000000000006), vec2(1.1937499999999999, 0.26250000000000007), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.26250000000000007), vec2(1.20625, 0.2750000000000001), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.2750000000000001), vec2(1.1937499999999999, 0.2875000000000001), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.2875000000000001), vec2(1.20625, 0.3000000000000001), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.3000000000000001), vec2(1.1937499999999999, 0.3125000000000001), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.3125000000000001), vec2(1.20625, 0.3250000000000001), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.3250000000000001), vec2(1.1937499999999999, 0.33750000000000013), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.33750000000000013), vec2(1.20625, 0.35000000000000014), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.35000000000000014), vec2(1.1937499999999999, 0.36250000000000016), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.36250000000000016), vec2(1.20625, 0.37500000000000017), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.37500000000000017), vec2(1.1937499999999999, 0.3875000000000002), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.3875000000000002), vec2(1.20625, 0.4000000000000002), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.4000000000000002), vec2(1.1937499999999999, 0.4125000000000002), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.4125000000000002), vec2(1.20625, 0.4250000000000002), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.4250000000000002), vec2(1.1937499999999999, 0.4375000000000002), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.4375000000000002), vec2(1.20625, 0.45000000000000023), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.45000000000000023), vec2(1.1937499999999999, 0.46250000000000024), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.46250000000000024), vec2(1.20625, 0.47500000000000026), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.47500000000000026), vec2(1.1937499999999999, 0.48750000000000027), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.48750000000000027), vec2(1.20625, 0.5000000000000002), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.5000000000000002), vec2(1.1937499999999999, 0.5125000000000002), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.5125000000000002), vec2(1.20625, 0.5250000000000001), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.5250000000000001), vec2(1.1937499999999999, 0.5375000000000001), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.5375000000000001), vec2(1.20625, 0.55), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.55), vec2(1.1937499999999999, 0.5625), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.5625), vec2(1.20625, 0.575), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.575), vec2(1.1937499999999999, 0.5874999999999999), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.5874999999999999), vec2(1.20625, 0.5999999999999999), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.5999999999999999), vec2(1.1937499999999999, 0.6124999999999998), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.6124999999999998), vec2(1.20625, 0.6249999999999998), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.6249999999999998), vec2(1.1937499999999999, 0.6374999999999997), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.6374999999999997), vec2(1.20625, 0.6499999999999997), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.6499999999999997), vec2(1.1937499999999999, 0.6624999999999996), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.6624999999999996), vec2(1.20625, 0.6749999999999996), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.6749999999999996), vec2(1.1937499999999999, 0.6874999999999996), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.6874999999999996), vec2(1.20625, 0.6999999999999995), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.6999999999999995), vec2(1.1937499999999999, 0.7124999999999995), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.7124999999999995), vec2(1.20625, 0.7249999999999994), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.7249999999999994), vec2(1.1937499999999999, 0.7374999999999994), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.7374999999999994), vec2(1.20625, 0.7499999999999993), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.7499999999999993), vec2(1.1937499999999999, 0.7624999999999993), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.7624999999999993), vec2(1.20625, 0.7749999999999992), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.7749999999999992), vec2(1.1937499999999999, 0.7874999999999992), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.7874999999999992), vec2(1.20625, 0.7999999999999992), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.7999999999999992), vec2(1.1937499999999999, 0.8124999999999991), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.8124999999999991), vec2(1.20625, 0.8249999999999991), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.8249999999999991), vec2(1.1937499999999999, 0.837499999999999), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.837499999999999), vec2(1.20625, 0.849999999999999), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.849999999999999), vec2(1.1937499999999999, 0.8624999999999989), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.8624999999999989), vec2(1.20625, 0.8749999999999989), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.8749999999999989), vec2(1.1937499999999999, 0.8874999999999988), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.8874999999999988), vec2(1.20625, 0.8999999999999988), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.8999999999999988), vec2(1.1937499999999999, 0.9124999999999988), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.9124999999999988), vec2(1.20625, 0.9249999999999987), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.9249999999999987), vec2(1.1937499999999999, 0.9374999999999987), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.9374999999999987), vec2(1.20625, 0.9499999999999986), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.9499999999999986), vec2(1.1937499999999999, 0.9624999999999986), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.9624999999999986), vec2(1.20625, 0.9749999999999985), 0.0, isect);
    lineIntersect(ray, vec2(1.20625, 0.9749999999999985), vec2(1.1937499999999999, 0.9874999999999985), 0.0, isect);
    lineIntersect(ray, vec2(1.1937499999999999, 0.9874999999999985), vec2(1.20625, 0.9999999999999984), 0.0, isect);
}

vec2 sample(inout vec4 state, Intersection isect, float lambda, vec2 wiLocal, inout vec3 throughput, out float tMult) {
    tMult = 1.0;
    if (isect.mat == 1.0) {
        return sampleRoughMirror(state, wiLocal, throughput, 0.5);
        float ior = sqrt(sellmeierIor(vec3(1.0396, 0.2318, 1.0105), vec3(0.0060, 0.0200, 103.56), lambda));
        if (wiLocal.y < 0.0) {
            // The ray comes from inside the dielectric material - it will take longer times
            tMult = ior;
        }
        return sampleDielectric(state, wiLocal, ior);
    } else if (isect.mat == 2.0) {
        return sampleMirror(wiLocal);
    } else if (isect.mat == 3.0) {
        throughput *= vec3(0.0);
        return sampleDiffuse(state, wiLocal);
    } else {
        throughput *= vec3(0.5);
        return sampleDiffuse(state, wiLocal);
    }
}