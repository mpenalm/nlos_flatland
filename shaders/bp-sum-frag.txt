#include "preamble"

uniform sampler2D fluence; // x time, y spad

uniform float numPixels;

varying vec2 mPos; // Pixel coordinates [0,1]

const int numSpads = {numSpads};

void main() {
    float x = floor(mPos.x * numPixels);
    float y = floor(mPos.y * numPixels);
    float pos = x + numPixels * (numPixels - 1.0 - y);
    pos = (pos + 0.5) / (numPixels * numPixels);

    float spadDist = 1.0 / float(numSpads);

    vec2 fluenceAccum = vec2(0.0);
    for (int i = 0; i < numSpads; i++) {
        fluenceAccum += texture2D(fluence, vec2(pos, spadDist * (float(i) + 0.5))).xy;
    }

    gl_FragColor = vec4(fluenceAccum, 0.0, 1.0);
}
